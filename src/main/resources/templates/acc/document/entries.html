<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–æ–¥–∫–∏: —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<h2 class="mb-3">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å—å–∫—ñ –ø—Ä–æ–≤–æ–¥–∫–∏</h2>

<form th:action="@{/entries/save}" method="post" id="entryForm">
    <table class="table table-bordered" id="entryTable">
        <thead class="table-light">
        <tr>
            <th>#</th>
            <th>–î–∞—Ç–∞</th>
            <th>–î–µ–±–µ—Ç</th>
            <th>–ö—Ä–µ–¥–∏—Ç</th>
            <th>–°—É–º–∞</th>
            <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
            <th>–î—ñ—è</th>
        </tr>
        </thead>
        <tbody id="entryTableBody">
        <tr th:each="entry, stat : ${entries}">
            <td th:text="${stat.count}"></td>
            <td><input type="date" class="form-control" th:name="'entries[' + ${stat.index} + '].date'" th:value="${#dates.format(entry.date, 'yyyy-MM-dd')}" /></td>
            <td><input type="text" class="form-control" th:name="'entries[' + ${stat.index} + '].debitAccount'" th:value="${entry.debitAccount}" /></td>
            <td><input type="text" class="form-control" th:name="'entries[' + ${stat.index} + '].creditAccount'" th:value="${entry.creditAccount}" /></td>
            <td><input type="number" step="0.01" class="form-control" th:name="'entries[' + ${stat.index} + '].amount'" th:value="${entry.amount}" /></td>
            <td><input type="text" class="form-control" th:name="'entries[' + ${stat.index} + '].comment'" th:value="${entry.comment}" /></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">‚úï</button></td>
        </tr>
        </tbody>
    </table>

    <button type="button" class="btn btn-outline-primary mb-3" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
    <br>
    <button type="submit" class="btn btn-success">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ</button>
</form>

<script>
    let rowIndex = /*[[${entries.size()}]]*/ 0;

    function addRow() {
        const tbody = document.getElementById("entryTableBody");

        const row = document.createElement("tr");
        row.innerHTML = `
            <td></td>
            <td><input type="date" name="entries[${rowIndex}].date" class="form-control" /></td>
            <td><input type="text" name="entries[${rowIndex}].debitAccount" class="form-control" /></td>
            <td><input type="text" name="entries[${rowIndex}].creditAccount" class="form-control" /></td>
            <td><input type="number" step="0.01" name="entries[${rowIndex}].amount" class="form-control" /></td>
            <td><input type="text" name="entries[${rowIndex}].comment" class="form-control" /></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">‚úï</button></td>
        `;
        tbody.appendChild(row);
        updateIndexes();
        rowIndex++;
    }

    function removeRow(button) {
        const row = button.closest("tr");
        row.remove();
        updateIndexes();
    }

    function updateIndexes() {
        const rows = document.querySelectorAll("#entryTableBody tr");
        rows.forEach((row, index) => {
            row.querySelector("td:first-child").textContent = index + 1;
            const inputs = row.querySelectorAll("input");
            inputs.forEach(input => {
                const name = input.name;
                const field = name.substring(name.indexOf("].") + 2); // get field name
                input.name = `entries[${index}].${field}`;
            });
        });
    }
</script>

</body>
</html>

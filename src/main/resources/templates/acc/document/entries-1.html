<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–æ–¥–∫–∏ (—ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<h2 class="mb-3">–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å—å–∫—ñ –ø—Ä–æ–≤–æ–¥–∫–∏</h2>

<form id="entryForm" th:action="@{/entries/save}" method="post">
    <table class="table table-bordered table-hover" id="entryTable">
        <thead class="table-light">
        <tr>
            <th>#</th>
            <th>–î–∞—Ç–∞</th>
            <th>–î–µ–±–µ—Ç</th>
            <th>–ö—Ä–µ–¥–∏—Ç</th>
            <th>–°—É–º–∞</th>
            <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
            <th>–î—ñ—è</th>
        </tr>
        </thead>
        <tbody id="entryBody">
        <!-- –ü—Ä–∏–∫–ª–∞–¥ 1 —Ä—è–¥–∫–∞, –¥–ª—è Thymeleaf -->
        <tr th:each="entry, stat : ${entries}">
            <td th:text="${stat.count}">1</td>
            <td><input type="date" class="form-control form-control-sm" th:name="'entries[' + ${stat.index} + '].date'" th:value="${#dates.format(entry.date, 'yyyy-MM-dd')}"/></td>
            <td><input type="text" class="form-control form-control-sm" th:name="'entries[' + ${stat.index} + '].debitAccount'" th:value="${entry.debitAccount}"/></td>
            <td><input type="text" class="form-control form-control-sm" th:name="'entries[' + ${stat.index} + '].creditAccount'" th:value="${entry.creditAccount}"/></td>
            <td><input type="number" step="0.01" class="form-control form-control-sm" th:name="'entries[' + ${stat.index} + '].amount'" th:value="${entry.amount}"/></td>
            <td><input type="text" class="form-control form-control-sm" th:name="'entries[' + ${stat.index} + '].comment'" th:value="${entry.comment}"/></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">üóë</button></td>
        </tr>
        </tbody>
    </table>

    <button type="button" class="btn btn-secondary" onclick="addRow()">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
    <button type="submit" class="btn btn-success">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏</button>
</form>

<script>
    let rowIndex = document.querySelectorAll('#entryBody tr').length;

    function addRow() {
        const tbody = document.getElementById("entryBody");

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${rowIndex + 1}</td>
            <td><input type="date" name="entries[${rowIndex}].date" class="form-control form-control-sm" /></td>
            <td><input type="text" name="entries[${rowIndex}].debitAccount" class="form-control form-control-sm" /></td>
            <td><input type="text" name="entries[${rowIndex}].creditAccount" class="form-control form-control-sm" /></td>
            <td><input type="number" step="0.01" name="entries[${rowIndex}].amount" class="form-control form-control-sm" /></td>
            <td><input type="text" name="entries[${rowIndex}].comment" class="form-control form-control-sm" /></td>
            <td><button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">üóë</button></td>
        `;
        tbody.appendChild(row);
        rowIndex++;
    }

    function removeRow(btn) {
        const row = btn.closest("tr");
        row.remove();
        // –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î–º–æ —ñ–Ω–¥–µ–∫—Å–∏, —â–æ–± —Ñ–æ—Ä–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è–ª–∞ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –º–∞—Å–∏–≤
        document.querySelectorAll('#entryBody tr').forEach((tr, index) => {
            tr.querySelectorAll("input").forEach(input => {
                input.name = input.name.replace(/entries\[\d+\]/, `entries[${index}]`);
            });
            tr.children[0].textContent = index + 1;
        });
        rowIndex--;
    }
</script>

</body>
</html>
